machine:
  environment:
    APP_NAME: lgtm

dependencies:
  pre:
    - ln -s /home/ubuntu/.go_project/src/github.com/AusDTO /home/ubuntu/.go_project/src/github.com/lgtmco
  override:
    - go get -u github.com/jteeuwen/go-bindata/...
    - go get -u github.com/elazarl/go-bindata-assetfs/...
    - go get -u github.com/vektra/mockery/...
    - go get -u github.com/Sirupsen/logrus/...
    - go get -u github.com/gin-gonic/contrib/ginrus
    - go get -u github.com/ianschenck/envflag/... 
    - go get -u github.com/joho/godotenv/...
    - make gen
    - GOOS=linux GOARCH=amd64 go build -o lgtm

test:
  pre:
    - make test

  override:
    - make test

deployment:
  staging:
    branch: /.*/
    commands:
      - cf api $CF_API_DEV 2>&1 /dev/null
      - cf auth $CF_STAGING_USER $CF_STAGING_PASSWORD 2>&1 /dev/null
      - cf target -o $CF_ORG_DEV 2>&1 /dev/null
      - cf target -s $CF_SPACE_DEV 2>&1 /dev/null
      - cf push $APP_NAME 2>&1 /dev/null


