machine:
  environment:
    APP_NAME: lgtm

dependencies:
  override:
    - go get -u github.com/jteeuwen/go-bindata/...
    - go get -u github.com/elazarl/go-bindata-assetfs/...
    - go get -u github.com/vektra/mockery/...
    - go get -u github.com/Sirupsen/logrus/...
    - go get -u github.com/gin-gonic/contrib/ginrus/...
    - go get -u github.com/ianschenck/envflag/... 
    - go get -u github.com/joho/godotenv/autoload/...
    - go get -u github.com/lgtmco/lgtm/router/...
    - go get -u github.com/lgtmco/lgtm/router/middleware/...
    - make gen
    - GOOS=linux GOARCH=amd64 go build -o lgtm

test:
  pre:
    - make test

  override:
    - make test

deployment:
  staging:
    branch: /.*/
    commands:
      - cf api $CF_API_DEV
      - cf auth $CF_STAGING_USER $CF_STAGING_PASSWORD
      - cf target -o $CF_ORG_DEV
      - cf target -s $CF_SPACE_DEV
      - cf push $APP_NAME 


